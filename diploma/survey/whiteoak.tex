\subsubsection{Whiteoak}
Whiteoak - это расширение языка Java которое добавляет поддержку структурных типов\cite{whiteoak}. Whiteoak состоит из двух частей: модификации компилятора Java с целью добавить новыую синтаксическую конструкцию с проверкой типов и библиотеки времени выполнения. Для каждого протокола во время компиляции генерируется абстрактный класс. Во время выполнения для каждого типа, который присваивается к типу протокола, генерируется специальный класс наследник абстрактного класса протокола. Этот класс делегирует вызов методов протокола реальным вызовам на объекте.

Из такой реализации следует что невозможно создание самостоятельных структурных типов и определение конструкторов, определение статических методов.

\begin{minted}{java}
struct Source {
  int read();
}

class Impl {
  int read() {
    return 0;
  }
}

void exhaust(Source s) {
  while (s.read() >= 0) {
  }
}

void run() {
  Impl impl = new Impl();
  exhaust(impl);
}

\end{minted}

Преимущество данного подхода - высокая скорость работы. После генерации класса обёртки, скорость вызова метода протокола сводится к двум выполнениям инструкции invokevirtual, что практически не отличимо от обычного вызова метода.

Существенным недостатком данного подхода является потеря идентичности объекта при оборачивании. Дело в том что один и тот же объект, дважды приведённый к типу протокола, имеет разные обёртки, а следовательно и разные ссылки. В Whiteoak проблема решена следующим образом: везде где пользователь использует объект как сущность, используется ссылка на реальный объект. Это вносит определённые ограничения на использование протоколов в типовых параметрах. Появляется неоднозначность, какой объект ожидает метод: обёртку или ссылку. Эта проблема не решается в момент выполнения, поэтому Whiteoak запрещает использование параметрических типов для протоколов.
